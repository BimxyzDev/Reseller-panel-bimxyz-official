<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; background:#0d1117; color:#e6e6e6; display:flex; justify-content:center; align-items:center; min-height:100vh; margin:0; }
    .card { background:#161b22; padding:20px; border-radius:12px; width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.5); }
    h2 { margin-top:0; }
    input, button { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none; }
    input { background:#0d1117; border:1px solid #30363d; color:#fff; }
    button { background:#238636; color:#fff; cursor:pointer; font-weight:bold; }
    button:hover { background:#2ea043; }
    .danger { background:#da3633; }
    .danger:hover { background:#f85149; }
    .hidden { display:none; }
    .log { background:#0d1117; padding:10px; border-radius:8px; margin-top:10px; font-size:13px; max-height:200px; overflow:auto; }
  </style>
</head>
<body>
  <div class="card" id="loginCard">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username">
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
    <div class="log" id="loginLog"></div>
  </div>

  <div class="card hidden" id="dashboard">
    <h2>Admin Dashboard</h2>

    <h3>Config Panel</h3>
    <input type="text" id="panelUrl" placeholder="Panel URL">
    <input type="text" id="apiKey" placeholder="API Key">
    <button onclick="updateConfig()">Update Config</button>

    <h3>Tambah User cPanel</h3>
    <input type="text" id="newUser" placeholder="Username">
    <input type="password" id="newPass" placeholder="Password">
    <button onclick="addUser()">Tambah User</button>

    <h3>Daftar User</h3>
    <div id="userList"></div>
    <div class="log" id="adminLog"></div>
  </div>

<script>
async function adminLogin() {
  const username = document.getElementById("adminUser").value;
  const password = document.getElementById("adminPass").value;
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"adminLogin", username, password })
  });
  const data = await res.json();
  if (data.success) {
    document.getElementById("loginCard").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    loadConfig();
    loadUsers();
  } else {
    document.getElementById("loginLog").innerText = data.message;
  }
}

async function updateConfig() {
  const panelUrl = document.getElementById("panelUrl").value;
  const apiKey = document.getElementById("apiKey").value;
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"updateConfig", panelUrl, apiKey })
  });
  const data = await res.json();
  document.getElementById("adminLog").innerText = data.message;
}

async function loadConfig() {
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"getConfig" })
  });
  const data = await res.json();
  if (data.success && data.config) {
    document.getElementById("panelUrl").value = data.config.panelUrl || "";
    document.getElementById("apiKey").value = data.config.apiKey || "";
  }
}

async function addUser() {
  const username = document.getElementById("newUser").value;
  const password = document.getElementById("newPass").value;
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"addUser", username, password })
  });
  const data = await res.json();
  document.getElementById("adminLog").innerText = data.message;
  loadUsers();
}

async function loadUsers() {
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"getUsers" })
  });
  const data = await res.json();
  if (data.success) {
    const list = document.getElementById("userList");
    list.innerHTML = "";
    data.users.forEach(u => {
      const div = document.createElement("div");
      div.textContent = u.username + " ";
      const btn = document.createElement("button");
      btn.textContent = "Hapus";
      btn.className = "danger";
      btn.onclick = () => deleteUser(u.username);
      div.appendChild(btn);
      list.appendChild(div);
    });
  }
}

async function deleteUser(username) {
  const res = await fetch("/api/server", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action:"deleteUser", username })
  });
  const data = await res.json();
  document.getElementById("adminLog").innerText = data.message;
  loadUsers();
}
</script>
</body>
</html>
